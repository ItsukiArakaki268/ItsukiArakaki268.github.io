+++
title = '自宅サーバーをsshでリモートアクセスできるようにした話'
date = 2023-10-26T12:56:24+09:00
draft = false
categories = ["", ""]
description = ""
image = ""
tags = ["サーバー", "ssh"]
+++

リモートアクセスしたい！

<!--more-->

## 事の発端

以前から、GUI の ubuntu を導入している pc をサーバーがわりに使用していたのですが、何気なく CUI の ubuntu-server を構築したいと思い立ったのが始まりでした。

## server 環境の構築

server の構築自体はすんなりと進みました。
ubuntu-server の ISO ファイルを入れた USB メモリからブートに成功。
その後、画面に従ってぽちぽちしているだけで OS のインストールが完了しました。（この時点ではネットワーク設定は触れていません！）

## IP アドレスの固定等のネットワーク設定

ubuntu は`etc/netplan`内にある`yamlファイル`を編集してネットワーク設定を行います。

```
network:
  version: 2
  ethernets:
    イーサネットインターフェース名:
      dhcp4: false
      dhcp6: false
      addresses: [固定するIPアドレス]
      gateway4: デフォルトゲートウェイのアドレス
      nameservers:
        addresses: [DNSアドレス]
```

今回は IP アドレスを固定するため、`dhcp4`と`dhcp6`は false に、残りのアドレスは適宜設定していきます。
この時、`yamlファイル`の書き込み権限を付与するのを忘れて 2~3 回 vim で入力し直しました。泣

## ssh の設定

IP アドレスの固定ができたので、次は ssh の設定をしていきます。
OS インストールの際に ssh はインストール済みなので、早速鍵を作っていきます。

```
$ ssh-keygen -t rsa
```

上記コマンド実行後、`~/.ssh`上に秘密鍵の`id_rsa`と公開鍵の`id_rsa.pub`が作成されます。
その後、秘密鍵の方を接続元の MacBook Air に、USB メモリを用いて転送。適当な場所に秘密鍵を格納し、ssh の config を編集してサーバーに ssh できるよう設定しました。この時、接続元にある秘密鍵のパーミッションが適切でなかったため、サーバーに接続するためにパスワードを求められてしまいました。

```
$ sudo chmod 600 ~/.ssh/秘密鍵の名前(今回の場合id_rsa)
```

上記のコマンドでパーミッションを適切に設定し、サーバーに ssh 接続することに成功しました。

## 今後の展望

今回は ssh の config にプライベート IP アドレスを設定し ssh 接続を行なったため、自宅 LAN 内でしか ssh できない状態になっています。今後は外出先で自宅サーバーに ssh できるようにしたいので、グローバル IP アドレスやポートフォワーディングなどの知識を深めて再挑戦したいと思います ☺️
